# Roadmap: CineChance Stabilization

**Created:** 2026-02-17
**Mode:** YOLO (Auto-approve)
**Goal:** Восстановить уверенность в коде

## Summary

**2 phases** | **8 requirements** | All v1 requirements covered ✓

## Phase Overview

| # | Phase | Goal | Requirements | Success Criteria |
|---|-------|------|--------------|------------------|
| 1 | Tests & Logging | Тесты + логирование | TEST-01, TEST-02, TEST-03, LOG-01, LOG-02 | 5 criteria |
| 2 | Error Handling | Error boundaries + graceful degradation | ERR-01, ERR-02, ERR-03, ERR-04 | 4 criteria |

---

## Phase 1: Tests & Logging

**Goal:** Добавить тесты и единое логирование

### Requirements
- TEST-01: Интеграционные тесты для критических API (auth, watchlist, recommendations)
- TEST-02: Unit тесты для утилит (weighted rating, score calculation)
- TEST-03: Unit тесты для валидации (filter validation)
- LOG-01: Единое логирование с контекстом во всех API routes
- LOG-02: Логирование в server actions

### Success Criteria
1. Есть тесты для auth — register, login, session
2. Есть тесты для watchlist — add, update, delete
3. Есть тесты для recommendations — basic functionality
4. Есть тесты для weighted rating calculation
5. Все API routes используют единый logger с контекстом

### Implementation Notes
- Использовать существующий vitest.config.ts
- Тесты в src/lib/__tests__/
- Использовать msw для API mocking
- Logger уже есть в src/lib/logger.ts

---

## Phase 2: Error Handling

**Goal:** Error boundaries + graceful degradation

### Requirements
- ERR-01: Error boundary компоненты (AsyncErrorBoundary уже есть — расширить)
- ERR-02: Error boundary для критических секций UI
- ERR-03: Красивые error pages (404, 500)
- ERR-04: Graceful degradation для TMDB API

### Success Criteria
1. При ошибке API пользователь видит понятное сообщение, не ломается весь UI
2. Критические секции (movie grid, recommendations) изолированы error boundaries
3. Есть красивая 404 страница
4. При недоступности TMDB показываются заглушки

### Implementation Notes
- Расширить существующий AsyncErrorBoundary
- Использовать Suspense fallback для компонентов
- TMDB fallback уже есть — проверить и расширить

**Plans:** 2 plans

Plans:
- [ ] 02-01-PLAN.md — Extend AsyncErrorBoundary + TMDB cache
- [ ] 02-02-PLAN.md — Error pages + UI error boundaries

---

## Execution Notes

- **Не менять существующий функционал** — только добавлять тесты, логирование, error handling
- **Каждая задача — отдельный коммит** — легко откатить
- **Запускать тесты после каждого изменения** — npm run test:ci
- **Проверять линтер** — npm run lint

---

## После стабилизации

Когда обе фазы завершены и есть уверенность — можно планировать:
- Performance оптимизацию
- Новую функциональность
