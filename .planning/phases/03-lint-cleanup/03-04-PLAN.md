---
phase: 03-lint-cleanup
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
requirements: []
gap_closure: true
must_haves:
  truths:
    - "npm run lint проходит без ошибок (0 errors)"
    - "Нет eslint-disable для any типов (типы исправлены, не подавлены)"
    - "Нет неиспользуемых переменных"
    - "Нет проблем с react-hooks"
  artifacts: []
  key_links: []
---

<objective>
Финальное исправление ~239 ошибок lint для достижения цели "npm run lint = 0 errors".

Ключевое отличие от 03-03: УДАЛИТЬ eslint-disable комментарии и ИСПРАВИТЬ типы правильно.
</objective>

<context>
# Текущее состояние
- 239 errors, 123 warnings
- После удаления части eslint-disable в random/route.ts

# Проблемы после 03-03
- 03-03 добавила eslint-disable в 35+ файлов — это неправильный подход
- При удалении eslint-disable появляются новые ошибки (как в random/route.ts)

# Оставшиеся ошибки (ориентировочно)
1. no-unused-vars: ~150 ошибок (переменные с _ prefix)
2. @typescript-eslint/no-explicit-any: ~40 ошибок 
3. react-hooks: ~28 проблем

# Важно
- УДАЛИТЬ eslint-disable комментарии
- ИСПРАВИТЬ типы: unknown, Record<string, unknown>, proper types
- Префикс _ для неиспользуемых параметров
</context>

<tasks>

<task type="auto">
  <name>Task 1: Удалить eslint-disable и исправить типы</name>
  <files>[]</files>
  <action>
Найти и удалить eslint-disable комментарии:
1. grep -r "eslint-disable" src/app/api/ --include="*.ts"
2. Для каждого eslint-disable @typescript-eslint/no-explicit-any:
   - Определить правильный тип
   - Использовать: unknown, Record<string, unknown>, или конкретный тип
3. Пример для fetchMediaDetails: использовать any локально с явным указанием

Фокус на самых проблемных файлах:
- src/app/api/recommendations/random/route.ts
- src/app/api/search/route.ts
- src/app/api/my-movies/route.ts
  </action>
  <verify>`npm run lint 2>&1 | grep -c "eslint-disable"`</verify>
  <done>eslint-disable удалены, типы исправлены</done>
</task>

<task type="auto">
  <name>Task 2: Исправить неиспользуемые переменные</name>
  <files>[]</files>
  <action>
1. Запустить `npx eslint --fix` для авто-исправления
2. Для оставшихся ошибок:
   - Префикс _ для неиспользуемых параметров: _userId, _error
   - Удалить неиспользуемые const/let
   - Удалить неиспользуемые импорты

Файлы с наибольшим кол-вом:
- src/app/api/recommendations/random/route.ts
- src/app/api/my-movies/route.ts
- src/app/api/recommendations/predictions/route.ts
  </action>
  <verify>`npm run lint 2>&1 | grep -c "no-unused-vars"`</verify>
  <done>Минимум unused-vars ошибок</done>
</task>

<task type="auto">
  <name>Task 3: Исправить react-hooks проблемы</name>
  <files>[]</files>
  <action>
Для react-hooks ошибок:
1. set-state-in-effect: убрать setState из useEffect
   - Использовать условный рендеринг
   - Использовать useMemo
2. exhaustive-deps: добавить правильные зависимости
3. Файлы: AuthModal, FilmGridWithFilters, AsyncErrorBoundary
  </action>
  <verify>`npm run lint 2>&1 | grep -c "react-hooks"`</verify>
  <done>0 react-hooks ошибок</done>
</task>

<task type="auto">
  <name>Task 4: Финальная проверка</name>
  <files>[]</files>
  <action>
Запустить `npm run lint`:
- Должно быть 0 errors
- Предупреждения допустимы
  </action>
  <verify>`npm run lint`</verify>
  <done>npm run lint = 0 errors</done>
</task>

</tasks>

<verification>
`npm run lint` возвращает 0 errors
</verification>

<success_criteria>
- Достигнута цель: npm run lint = 0 errors
- eslint-disable УДАЛЕНЫ
- Типы ИСПРАВЛЕНЫ, не подавлены
</success_criteria>

<output>
After completion, create `.planning/phases/03-lint-cleanup/{phase}-04-SUMMARY.md`
</output>
